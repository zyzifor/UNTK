FUNCTION configDmb
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Модуль конфигурации - Dmb (обмен по Modbus/RTU). Сформирован: 08.08.2024 10:56 *)
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Name                Data Type      Dimension            Direction  Attribute       Comment                         *)
(* ------------------------------------------------------------------------------------------------------------------ *)
(* configDmb           BOOL                                VarOutput  Write           Результат выполнения функции *)
(* iPrgChange          BOOL                                VarInput   Read            Флаг изменения программы ПЛК *)
(* i                   DINT                                Var        Read/Write      Счётчик *)
(* _bRes               BOOL                                Var        Read/Write      Результат функции BOOL *)
(* _dRes               DINT                                Var        Read/Write      Результат функции DINT *)
(* ------------------------------------------------------------------------------------------------------------------ *)
configDmb           := true;
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Функция выполняется только при изменении программы ПЛК *)
if not iPrgChange then configDmb:= false; return; end_if;
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Проход по всем параметрам *)
i:= 1;   while i<=sDmb.iSize do
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Передача в Рабочий объект *)
  iDmb:= dDmb[i];
(* ------------------------------------------------------------------------------------------------------------------ *)
  (* Сброс запросов и виртуальных модулей *)
  iDmb.nDioMK541N:= 0; iDmb.nPort:= 1; iDmb.nId:= 0; iDmb.nSlave:= false;
  j:= 0;   while j<=7 do
    iDmb.nType[j]:= 0; iDmb.nFC[j]:= 0; iDmb.nAddr[j]:= 0; iDmb.nLen[j]:= 0; iDmb.nOffs[j]:= 0;
    iDmb.nMK541Req[j]:= -1; iDmb.nMK541Offs[j]:= -10;
  j:= j+1; end_while;
  iDmb.nModify:= 0; iDmb.nSingle:= 0;
(* ------------------------------------------------------------------------------------------------------------------ *)
  (* Настройка запросов и виртуальных модулей *)
  case i of
      1: (* --------------------------------------------------------------------------------------------------------- *)
        (* №=  1 СЭО-1      ШЭО (система электрообогрева)  Группа параметров 1                                          *)
        iDmb.nDioMK541N:=   1; iDmb.nPort:= 1; iDmb.nId:=  15; ;
        (* №=0 AIW08 Виртуальный модуль ввода-вывода *)
        iDmb.nType[0]:=   1008; iDmb.nFC[0]:=  3; iDmb.nAddr[0]:=     0; iDmb.nLen[0]:=   8; iDmb.nOffs[0]:=  0; iDmb.nMK541Req[0]:=   0; iDmb.nMK541Offs[0]:=    1; 
        (* №=1 AIW04 Виртуальный модуль ввода-вывода *)
        iDmb.nType[1]:=   1004; iDmb.nFC[1]:=  3; iDmb.nAddr[1]:=   100; iDmb.nLen[1]:=   4; iDmb.nOffs[1]:=  8; iDmb.nMK541Req[1]:=   1; iDmb.nMK541Offs[1]:=    9; 
        (* №=2 EMP00 Виртуальный модуль ввода-вывода *)
        (* №=3 EMP00 Виртуальный модуль ввода-вывода *)
        (* №=4 EMP00 Виртуальный модуль ввода-вывода *)
        (* №=5 EMP00 Виртуальный модуль ввода-вывода *)
        (* №=6 EMP00 Виртуальный модуль ввода-вывода *)
        (* №=7 EMP00 Виртуальный модуль ввода-вывода *)
  end_case;
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Передача из Рабочего объекта *)
  dDmb[i]:= iDmb;
(* ------------------------------------------------------------------------------------------------------------------ *)
(* Отключение резевных объектов *)
i:= i+1; end_while;
END_FUNCTION